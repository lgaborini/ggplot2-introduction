
---
class: center, middle, inverse

# G√©om√©tries

---

# G√©om√©tries

Les plus importantes :

- `geom_point` : points
- `geom_line` : lignes
- `geom_text`, `geom_label` : du texte   

--
- `geom_abline`, `geom_vline`, `geom_hline` :   
  lignes selon pente / intersection avec les axes   
--

- `geom_histogram`, `geom_boxplot`, `geom_density`   

--
- `geom_polygon`, `geom_path` :   
  un polygone ou parcours, vertex en ordre de apparition dans `data`
- `geom_raster`, `geom_contour` : pour donn√©es 2D   

--

Mini-guide : üìñ [Data visualization cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf)   

--

### Anatomie d'une g√©om√©trie :  

- `geom_*(mapping = ..., data = ..., stat = ..., position = ..., ...)`
- `mapping` sp√©cifie les **esth√©tiques** (correspondances entre variables)
- `data = ...` est utile pour lire un `data` modifi√©

---

# Esth√©tiques

Presque toutes les g√©om√©tries supportent les esth√©tiques :

- `x`, `y`, `col` (bord), `fill` (remplissage), `alpha` (transparence).

Autres esth√©tiques :  
- `shape`, `lwd` (poids des lignes), `lty` (type des lignes), `size` (dimension des objets), ...

--

- G√©om√©tries particuli√®res :    
  `xmin`, `xmax`, `ymin`, `ymax`, `group`, ... ‚Üí ![:read_the_docs]
  
--

- On peut les sp√©cifier ailleurs :   
  `geom_*(aes(...))`, ou `ggplot2(aes(...))` (partag√©es parmi les `geoms`)

--

- Variables non in `data` : plac√©s en dehors de `aes`

```{r ggplot-aes, eval=FALSE}
my_size <- 0.5
ggplot(mtcars, aes(x = mpg, y = wt)) +
  geom_point(aes(col = cyl), size = my_size) #<<
```


---

# Esth√©tiques

Vous pouvez utiliser des expressions :

.small-code[
```{r, fig.height=4}
ggplot(mtcars) +
    geom_point(
      aes(x = qsec, y = mpg, 
          col = hp/wt,     #<<
          shape = factor(am)),  #<<
      size = 5) +
    labs(title = 'Rapport puissance/poids', x = 'Mile time [s]', y = 'Autonomie')
```
]

---
class: twocol-code-plot

# Un boxplot...

Consommation vs nombre de cylindres

.left-code[

```{r boxplot-exemple, opts.label='twocol_code'}
mtcars %>% 
   ggplot(aes(x = factor(cyl), y = mpg)) + 
   geom_boxplot(aes(fill = factor(cyl))) +
   labs(x = 'Cylindres', y = 'Autonomie')
```

`labs(...)` : titres des axes

]
.right-plot[

```{r boxplot-plot, ref.label='boxplot-exemple', opts.label = 'twocol_plot'}

```
]

--

.left-inline[
Boxplot : m√©diane, quartiles, moustaches
]

--

.left-inline[
... mais qui les a calcul√©s ?
]

---
class: center, middle, inverse

# Les statistiques

---

# Les statistiques

Avant de plotter :

- `data` est s√©par√© en groupes selon les variables discr√®tes :
    + ce qu'on trouve dans `facets`
    + ce qu'on assigne √† `col`, `fill`, `group`, ...

--

- Pour chaque sous-ensemble de `data`, le niveau `stat` calcule tout le n√©cessaire

--

- Cons√©quence : √† chaque `geom` correspond un `stat` (souvent cach√© ! )

--

En pratique :

- `stat` ajoute des **colonnes** √† `data` avec des noms fixes

---

## Les statistiques : exemple

Consommation vs poids : notez les esth√©tiques partag√©es

```{r geom-smooth-pre}
p <- ggplot(mtcars, aes(x = mpg, y = wt)) + 
     geom_point()
p
```


---

## Les statistiques : exemple

- Ajout du niveau `geom_smooth` : smoothing
  + lin√©aire : `method = "lm"` (et autres)
  + non-lin√©aire : dans ce cas `method = "loess"` (et autres)
--

- `geom_smooth` adore `stat_smooth` :
    + calcule les pr√©dictions `y`, intervalles `ymin`, `ymax`, erreur `se`
    + repr√©sentation graphique optimale

```{r geom-smooth, fig.height=4}
p + geom_smooth(method = 'loess')
```

---
class: slide-class-advanced

## Les statistiques : exemple

- On peut acc√©der aux valeurs avec `stat(...)` dans le m√™me niveau !   
  (vieux code : les nouvelles variables commencent par `...`)

--

- Moyenne + intervalles de confiance pour la moyenne, $6\sigma$

.small-code[
```{r stat-manual, fig.height=4}
p + 
  geom_errorbar(aes(ymin = y - 3*stat(se), ymax = y + 3*stat(se), col = stat(se)), 
                alpha = 0.2,
                stat = 'smooth', method = 'loess') +
  scale_color_gradient('Standard error', low = 'blue', high = 'red')
```
]



---

# Position

```{r, include=FALSE}
fig_height_position <- 4
```

Quand on a des **√©l√©ments superpos√©s** : (p.ex. diagramme √† barre)

- Il y a une `stat_count` cach√©e ! (d√©finit $y$)
- Par d√©faut, empil√©s (`geom_bar`) ou superpos√©s (`geom_point`) 

```{r, fig.height=fig_height_position}
ggplot(mtcars) + 
  geom_bar(aes(x = factor(cyl), fill = factor(am)))
```

---

# Position

Param√®tre `position` :

- `dodge` : √† cot√©

```{r, fig.height=fig_height_position}
ggplot(mtcars) + 
  geom_bar(aes(x = factor(cyl), fill = factor(am)),
           position = 'dodge')  #<<
```

---

# Position

Param√®tre `position` :

- `fill` : normalise

```{r, fig.height=fig_height_position}
ggplot(mtcars) + 
  geom_bar(aes(x = factor(cyl), fill = factor(am)),
           position = 'fill')  #<<
```

---

# Position

Param√®tre `position` :

- `stack` : empiler

```{r, fig.height=fig_height_position}
ggplot(mtcars) + 
  geom_bar(aes(x = factor(cyl), fill = factor(am)),
           position = 'stack')  #<<
```


---

# Position

Param√®tre `position` :

- `jitter` : ajout du bruit pour s√©parer

```{r, fig.height=fig_height_position}
ggplot(mtcars) + 
  geom_point(aes(x = am, y = vs))
```

---

# Position

Param√®tre `position` :

- `jitter` : ajout du bruit pour s√©parer

```{r, fig.height=fig_height_position}
ggplot(mtcars) + 
  geom_point(aes(x = am, y = vs),
           position = 'jitter') #<<
```


---
class: small-code

# Position

Param√®tre `position` :

- `jitter` : ajout du bruit pour s√©parer   
  R√©glage ou `geom_jitter()`

```{r, fig.height=fig_height_position}
ggplot(mtcars) + 
  geom_point(aes(x = am, y = vs),
             position = position_jitter(width = 0.1, height = 0.1)) #<<
```


  
