<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Introduction √† ggplot2</title>
    <meta charset="utf-8" />
    <meta name="author" content="Lorenzo Gaborini" />
    <meta name="date" content="2019-03-26" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="assets\css\ribbon-advanced.css" type="text/css" />
    <link rel="stylesheet" href="assets\css\custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Introduction √† ggplot2
## Caf√© des doctorants
### Lorenzo Gaborini
### 2019-03-26

---







layout: true

&lt;div class="ribbon-advanced"&gt;&lt;span&gt;Advanced!&lt;/span&gt;&lt;/div&gt;
&lt;div id='overlay'&gt;&lt;/div&gt;



---
class: inverse

### Contr√¥les

Appuyer sur &lt;span class="help-key"&gt;h&lt;/span&gt; ou &lt;span class="help-key"&gt;?&lt;/span&gt; pour contr√¥ler la pr√©sentation.

---

# Buts

- R moderne : nouveaux outils

--

- Introduction au `tidyverse`

--

- Familiariser avec la librairie `ggplot2`

--

- Extensions

--

- `ggplot2` est √©norme : **concepts** et **autonomie** !

--

- Pour informations : 
    + Stack Overflow
    + Cheatsheets : https://www.rstudio.com/resources/cheatsheets/
    + Documentation : https://ggplot2.tidyverse.org/reference/

---

# Pr√©requis

## Logiciels

  - R (n√©cessaire)

--

  - connaissances de base

--

  - Ressources: 
      + [R for Data Science](https://r4ds.had.co.nz/index.html) : guide au `tidyverse`
      + [TidyTuesday](https://github.com/rfordatascience/tidytuesday) : **a weekly social data project in R**
      + [ggplot2 cookbook](http://www.cookbook-r.com/Graphs/)

--

  - [RStudio](https://www.rstudio.com/) (conseill√©)
      + interface compl√®te pour **√©crire**, **d√©velopper** et **produire**
      + literate programming : **R Markdown**, articles, pr√©sentations, sites web, ...





---
class: inverse, middle, center

# R : les bases

---

# R moderne : le tidyverse

-  ![:package_cran tidyverse] : √©cosyst√®me de packages qui travaillent bien ensemble

![](assets/img/tidyverse1.png) et autres...

--

- Installation et chargement :   
  `install.packages("tidyverse")`   
  `library(tidyverse)`

&lt;!-- 
- `apply`, `sapply`, `vapply`, ... : remplac√©s par `purrr::map`     
    `df[df$col == 'a', ]` &lt;span class='text-curse'&gt;(combien de `[` ??? )&lt;/span&gt; : remplac√© par `df %&gt;% filter(col == 'a')`
 --&gt;

---

# R moderne : le tidyverse

Les plus importants :

-  ![:package_cran readr] : lecture des donn√©es de fichiers (conversion en `data.frames`)

--

- ![:package_cran tidyr] : rangement de `data.frames`

--

- ![:package_cran dplyr] : manipulation de `data.frames` :   
   + filtrage, transformations, regroupage (voir : `plyr`, mais mieux !)

--

- ![:package_cran ggplot2] : visualisation de donn√©es

--

Auteur principal : Hadley Wickham (https://github.com/hadley/)


---

## Caract√©ristiques communes

- Le premier param√®tre de chaque fonction est un `data.frame` qui contient l'information

--

- la valeur de retour est toujours un `data.frame` (ou `tibble`)

--

- fonctions faciles et pr√©visibles :   
  p.ex., `read_csv`, `mutate`, `select`, `summarize`, `filter`, `geom_point`, `geom_line`

--
    
- comportement pr√©visible : param√®tres et valeurs de retour, erreurs, ...

--

- tr√®s bonne documentation : R help, sites Internet, blogs, github

---

## Caract√©ristiques communes : pipe


- le **flux d'informations** est indiqu√© avec l'op√©rateur `%&gt;%` (**pipe**)

--

&lt;div class="heavy-box"&gt;
    &lt;pre class="remark-inline-code code-inline"&gt;f(x,y)&lt;/pre&gt; une fonction &lt;br/&gt;
    &lt;pre class="remark-inline-code code-inline"&gt;x %&gt;% f(y)&lt;/pre&gt; est √©quivalent √† &lt;pre class="remark-inline-code code-inline"&gt;f(x,y)&lt;/pre&gt;
&lt;/div&gt;

--

- Cons√©quence :   

&lt;div class="heavy-box"&gt;
    &lt;h5 style="display: inline"&gt;Lecture de gauche √† droite !&lt;/h5&gt;&lt;br/&gt;
    &lt;pre class="remark-inline-code code-inline"&gt;x %&gt;% f(y)&lt;/pre&gt; : 
    &lt;pre class="remark-inline-code code-inline"&gt;x&lt;/pre&gt; &lt;b&gt;"then"&lt;/b&gt; &lt;pre class="remark-inline-code code-inline"&gt;f(y)&lt;/pre&gt;
&lt;/div&gt;

- Clavier (R Studio) : par d√©faut
  + Windows : CTRL + ‚áß + M
  + Mac : ‚åò + ‚áß + M


---

## Caract√©ristiques communes : donn√©es rectangulaires

Dans le `tidyverse` on travaille avec :

&lt;div class="heavy-box"&gt;
&lt;span&gt;&lt;b&gt;donn√©es rectangulaires&lt;/b&gt; (&lt;b&gt;tidy data&lt;/b&gt;)&lt;/span&gt;&lt;/br&gt;
&lt;span&gt;chaque ligne est une observation, chaque colonne est une variable&lt;/span&gt;
&lt;/div&gt;

--
![:package_cran tidyr] vous aide ! (anciennement : ![:package_cran reshape2])

--

.img-small-80[
  .pull-left[
    ![](assets/img/gather.png)
  ]
  .pull-right[
    ![](assets/img/spread.png)
  ]
]

Aussi: `separate`, `unite`, ...   

![:read_the_docs] : [Data Import cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf)

---

# R moderne : exemple

Donn√©es sur les vols de New York en 2013 : ![:package_cran nycflights13]

--


```r
library(nycflights13)
head(flights, 20)
```

<div id="DT-flights" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="DT-flights">{"x":{"filter":"none","fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],[2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[517,533,542,544,554,554,555,557,557,558,558,558,558,558,559,559,559,600,600,601],[515,529,540,545,600,558,600,600,600,600,600,600,600,600,600,559,600,600,600,600],[2,4,2,-1,-6,-4,-5,-3,-3,-2,-2,-2,-2,-2,-1,0,-1,0,0,1],[830,850,923,1004,812,740,913,709,838,753,849,853,924,923,941,702,854,851,837,844],[819,830,850,1022,837,728,854,723,846,745,851,856,917,937,910,706,902,858,825,850],[11,20,33,-18,-25,12,19,-14,-8,8,-2,-3,7,-14,31,-4,-8,-7,12,-6],["UA","UA","AA","B6","DL","UA","B6","EV","B6","AA","B6","B6","UA","UA","AA","B6","UA","B6","MQ","B6"],[1545,1714,1141,725,461,1696,507,5708,79,301,49,71,194,1124,707,1806,1187,371,4650,343],["N14228","N24211","N619AA","N804JB","N668DN","N39463","N516JB","N829AS","N593JB","N3ALAA","N793JB","N657JB","N29129","N53441","N3DUAA","N708JB","N76515","N595JB","N542MQ","N644JB"],["EWR","LGA","JFK","JFK","LGA","EWR","EWR","LGA","JFK","LGA","JFK","JFK","JFK","EWR","LGA","JFK","EWR","LGA","LGA","EWR"],["IAH","IAH","MIA","BQN","ATL","ORD","FLL","IAD","MCO","ORD","PBI","TPA","LAX","SFO","DFW","BOS","LAS","FLL","ATL","PBI"],[227,227,160,183,116,150,158,53,140,138,149,158,345,361,257,44,337,152,134,147],[1400,1416,1089,1576,762,719,1065,229,944,733,1028,1005,2475,2565,1389,187,2227,1076,762,1023],[5,5,5,5,6,5,6,6,6,6,6,6,6,6,6,5,6,6,6,6],[15,29,40,45,0,58,0,0,0,0,0,0,0,0,0,59,0,0,0,0],["2013-01-01T10:00:00Z","2013-01-01T10:00:00Z","2013-01-01T10:00:00Z","2013-01-01T10:00:00Z","2013-01-01T11:00:00Z","2013-01-01T10:00:00Z","2013-01-01T11:00:00Z","2013-01-01T11:00:00Z","2013-01-01T11:00:00Z","2013-01-01T11:00:00Z","2013-01-01T11:00:00Z","2013-01-01T11:00:00Z","2013-01-01T11:00:00Z","2013-01-01T11:00:00Z","2013-01-01T11:00:00Z","2013-01-01T10:00:00Z","2013-01-01T11:00:00Z","2013-01-01T11:00:00Z","2013-01-01T11:00:00Z","2013-01-01T11:00:00Z"]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>year<\/th>\n      <th>month<\/th>\n      <th>day<\/th>\n      <th>dep_time<\/th>\n      <th>sched_dep_time<\/th>\n      <th>dep_delay<\/th>\n      <th>arr_time<\/th>\n      <th>sched_arr_time<\/th>\n      <th>arr_delay<\/th>\n      <th>carrier<\/th>\n      <th>flight<\/th>\n      <th>tailnum<\/th>\n      <th>origin<\/th>\n      <th>dest<\/th>\n      <th>air_time<\/th>\n      <th>distance<\/th>\n      <th>hour<\/th>\n      <th>minute<\/th>\n      <th>time_hour<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":7,"lengthChange":false,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,11,15,16,17,18]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

---

# R moderne : exemple

Devinez le r√©sultat !


```r
df &lt;- flights %&gt;% 
   filter(month %in% c(12, 1, 2)) %&gt;% 
   group_by(dest) %&gt;% 
   summarise(
      count = n(),
      dist = mean(distance, na.rm = TRUE),
      delay = mean(arr_delay, na.rm = TRUE)
   ) %&gt;% 
   filter(count &gt; 20, dest != "HNL")
```

(on a utilis√© `dplyr` : fonctions `filter`, `group_by`, `summarise`, `n` et `%&gt;%`)

---

# R moderne : exemple

Voil√† :


```r
head(df, 10)
```

```
## # A tibble: 10 x 4
##    dest  count  dist delay
##    &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 ABQ      31 1826  30.3 
##  2 ALB     174  143  26.8 
##  3 ATL    4126  757.  9.14
##  4 AUS     521 1515. 13.4 
##  5 AVL      31  583  12.1 
##  6 BDL     112  116  11.3 
##  7 BGR      56  378  19.7 
##  8 BHM      58  866  17.5 
##  9 BNA    1358  759. 16.6 
## 10 BOS    3586  191.  3.25
```

---

# R moderne : exemple

`nycflights13` contient aussi des informations sur les a√©roports :


```r
head(airports, 5)
```

```
## # A tibble: 5 x 8
##   faa   name                      lat   lon   alt    tz dst   tzone        
##   &lt;chr&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;        
## 1 04G   Lansdowne Airport        41.1 -80.6  1044    -5 A     America/New_~
## 2 06A   Moton Field Municipal ~  32.5 -85.7   264    -6 A     America/Chic~
## 3 06C   Schaumburg Regional      42.0 -88.1   801    -6 A     America/Chic~
## 4 06N   Randall Airport          41.4 -74.4   523    -5 A     America/New_~
## 5 09J   Jekyll Island Airport    31.1 -81.4    11    -5 A     America/New_~
```

---

# R moderne : exemple

Jointures avec `dplyr` :


```r
df_airports &lt;- df %&gt;% 
   left_join(airports, by = c('dest' = 'faa'))
```

```
## # A tibble: 7 x 11
##   dest  count  dist delay name          lat    lon   alt    tz dst   tzone 
##   &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 ABQ      31 1826  30.3  Albuquerqu~  35.0 -107.   5355    -7 A     Ameri~
## 2 ALB     174  143  26.8  Albany Intl  42.7  -73.8   285    -5 A     Ameri~
## 3 ATL    4126  757.  9.14 Hartsfield~  33.6  -84.4  1026    -5 A     Ameri~
## 4 AUS     521 1515. 13.4  Austin Ber~  30.2  -97.7   542    -6 A     Ameri~
## 5 AVL      31  583  12.1  Asheville ~  35.4  -82.5  2165    -5 A     Ameri~
## 6 BDL     112  116  11.3  Bradley In~  41.9  -72.7   173    -5 A     Ameri~
## 7 BGR      56  378  19.7  Bangor Intl  44.8  -68.8   192    -5 A     Ameri~
```

---

# R moderne : exemple

Visualisation avec `ggplot2` :


```r
library(sf)
library(maps)

# Read the USA map
us_states &lt;- sf::st_as_sf(
   maps::map("state", plot = FALSE, fill = TRUE)
)

p &lt;- df_airports %&gt;% 
   ggplot() +
   geom_sf(data = us_states) +
   geom_point(aes(x = lon, y = lat, size = delay)) +
   ggtitle('Winter average delays from NYC') +
   labs(x = '', y = '') +
   scale_size_continuous('Delay [min]')
```


---
class: middle

# R moderne : exemple

&lt;img src="index_files/figure-html/us-plot-show-1.svg" style="max-width: 100%" /&gt;




---
class: center, middle, inverse

# La grammaire des donn√©es

---

# R : dplyr

**Grammaire des donn√©es**

- Juste quelques notions !

--

- Les donn√©es sont des `data.frame` (`tibble`)

--

- **verbes** qui les transforment

--

   + filtrage par lignes : `filter`
   + filtrage par colonnes : `select`
   + ajout de colonnes : `mutate`, `rename`
   + groupage de lignes : `group_by`
   + rangement : `arrange`
   + r√©sum√© : `summarise`

- Connexions avec les bases des donn√©es plus commmunes (p.ex. sqlite)

--

- Paradigme **split-apply-combine**

--

   + donn√©es ‚Üí "je regroupe ‚Üí je transforme ‚Üí je simplifie"




---
class: center, middle, inverse

# Les graphiques

---

# R : base graphics

Ce qu'on apprend aux premiers courses : "`base`"

--

(p.ex. donn√©es : `mtcars`, caract√©ristiques de 32 automobiles)

- Scatter plot, points et lignes    
  `plot(x = mtcars$mpg, y = mtcars$wt, col = ..., pch = ..., ...)`   
  `lines(x = mtcars$mpg, y = mtcars$wt, col = ..., pch = ..., ...)`   
  `points(x = mtcars$mpg, y = mtcars$wt, col = ..., pch = ..., ...)`

- Diagrammes √† barres    
  `hist(x = mtcars$mpg)`

- Densit√©    
  `plot(density(x = mtcars$wt))`

- Boxplot   
  `boxplot(mtcars$wt)`

---

# R : base graphics

Exemple : 


```r
plot(x = mtcars$mpg, y = mtcars$wt, type = 'p', col = 'red')
title('Poids vs. consommation')
```

&lt;img src="index_files/figure-html/plot-base-1.svg" style="display: block; margin: auto;" /&gt;

---
class: twocol-code-plot

# R : base graphics, groupes

Avec **donn√©es group√©es** √ßa se complique !

Exemple : (coloration par cylindres)

.left-code[

```r
# Couleurs ici
cols &lt;- mtcars$cyl
cols[mtcars$cyl == 4] &lt;- 'red'
cols[mtcars$cyl == 6] &lt;- 'black'
cols[mtcars$cyl == 8] &lt;- 'blue'

plot(x = mtcars$mpg, y = mtcars$wt, 
     type = 'p', col = cols)
title('Poids vs. consommation')
legend('topright', 
       c('4 cyl', '6 cyl', '8 cyl'), 
       fill = c('red', 'black', 'blue'))
```
]

--

.right-plot[
&lt;img src="index_files/figure-html/unnamed-chunk-18-1.svg" width="95%" style="display: block; margin: auto;" /&gt;
]

---
class: twocol-code-plot

# R : base graphics, multiples

.left-code[

Graphiques multiples : il faut un cycle...


```r
par(mfrow = c(3,1))
for (cyl_sub in unique(mtcars$cyl)) {
   mtcars_sub &lt;- mtcars[mtcars$cyl == cyl_sub, ]
   plot(x = mtcars_sub$mpg, y = mtcars_sub$wt, type = 'p')
   title(paste('Poids vs consommation:', cyl_sub, 'cylindres'))
}
```

]
.right-plot[

&lt;img src="index_files/figure-html/unnamed-chunk-19-1.svg" width="95%" style="display: block; margin: auto;" /&gt;
]
---

# R : base graphics

Inconv√©nients : 

- aspect graphique pas agr√©able 

--

- m√©canisme compliqu√©

--

- interface pas uniforme

--

- duplication et r√©p√©tition : `\(\mathrm{Pr}(\text{erreur})\)` augmente !

--

- ...




---
class: center, middle, inverse
name: slide-grammaire-graphiques

# La **grammaire des graphiques**

---

# Grammaire des graphiques

Un graphique est une combinaison d'√©l√©ments ind√©pendants (**layers**) :

- &lt;b&gt;`data`&lt;/b&gt; : un jeu de donn√©es 

--

- &lt;b&gt;`aes`thetic mapping&lt;/b&gt; :   

--

    corr√©spondance entre les variables dans `data` et les variables graphiques
- &lt;b&gt;`geom`&lt;/b&gt; : un objet graphique (point, ligne, cercle, ...) qui sera montr√©

--

- &lt;b&gt;`position`&lt;/b&gt; : le d√©placement des objets de type `geom` (souvent: identit√©)

--

- &lt;b&gt;`stat`&lt;/b&gt; : un objet qui calcule des statistiques (moyennes, ...) : (souvent: identit√©)

--

- &lt;b&gt;`coord`&lt;/b&gt; : le syst√®me de cordonn√©es (cart√©siennes, polaires, ...)

--

- &lt;b&gt;`scale`&lt;/b&gt; : contr√¥le de la gamme des valeurs pour les donn√©es

--

- &lt;b&gt;`facet`&lt;/b&gt; : ajout de sous-graphiques

--

- &lt;b&gt;`theme`&lt;/b&gt; : r√©glage fin d'√©l√©ments graphiques 

--

- &lt;div class='heavy-box'&gt;Chaque graphique est une &lt;b&gt;somme&lt;/b&gt; de ces niveaux.&lt;/div&gt;

---
class: twocol-code-plot

## Grammaire des graphiques : exemple 

`ggplot2` est une impl√©mentation de la grammaire des graphiques.

- L'objet de base est `ggplot(data = ...)`

--

- Puis on y somme les autres niveaux :

--

.left-code[


```r
library(ggplot2)

ggplot(mtcars) +
   geom_point(aes(x = mpg, y = wt)) +
   ggtitle('Autonomie vs poids') +
   labs(x = 'Autonomie', y = 'Poids')
```

- `ggtitle` : le titre

- `labs` : √©tiquettes des axes, titre, sous-titre, ...

]

--

.right-plot[

&lt;img src="index_files/figure-html/unnamed-chunk-20-1.svg" width="95%" style="display: block; margin: auto;" /&gt;
]

---
class: twocol-code-plot

## Grammaire des graphiques : exemple avec groupes

.left-code[

```r
p &lt;- ggplot(mtcars) +
   geom_point(aes(x = mpg, y = wt, col = cyl)) +
   ggtitle('Autonomie vs poids; cylindres') +
   scale_color_continuous('Nombre de cylinders')
p
```

- `data` : `mtcars`
- `geom_point` : ajout d'une couche graphique de type "scatter plot"   
   Variables graphiques : `x`, `y`, `col` (couleur : facultative)
- `aes` : **aesthetic mapping**    
   dans `data`: `mpg`, `wt`, `cyl` ‚áí variables `x`, `y`, `col` dans le graphique
- `ggplot` adopte une √©chelle de couleur automatique pour des valeurs continues
 
]

--
.right-plot[

&lt;img src="index_files/figure-html/unnamed-chunk-21-1.svg" width="95%" style="display: block; margin: auto;" /&gt;
]
---
class: twocol-code-plot

## Grammaire des graphiques : exemple

L'exemple avec les sous-groupes : facile !

.left-code[


```r
ggplot(mtcars) +
   geom_point(aes(x = mpg, y = wt)) +
   facet_wrap( ~ cyl) +
   ggtitle('Autonomie vs poids')
```

- Le sous-groupe est la couche `facet_wrap` 
- `ggplot` cr√©e des sous-graphiques avec les valeurs de son argument
-  sous-graphiques automatiquement √©tiquet√©es

]
--
.right-plot[
&lt;img src="index_files/figure-html/unnamed-chunk-22-1.svg" width="95%" style="display: block; margin: auto;" /&gt;
]



---
class: center, middle, inverse

# G√©om√©tries

---

# G√©om√©tries

Les plus importantes :

- `geom_point` : points
- `geom_line` : lignes
- `geom_text`, `geom_label` : du texte   

--
- `geom_abline`, `geom_vline`, `geom_hline` :   
  lignes selon pente / intersection avec les axes   
--

- `geom_histogram`, `geom_boxplot`, `geom_density`   

--
- `geom_polygon`, `geom_path` :   
  un polygone ou parcours, vertex en ordre de apparition dans `data`
- `geom_raster`, `geom_contour` : pour donn√©es 2D   

--

Mini-guide : üìñ [Data visualization cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf)   

--

### Anatomie d'une g√©ometrie :  

- `geom_*(mapping = ..., data = ..., stat = ..., position = ..., ...)`
- `mapping` sp√©cifie les **esth√©tiques** (correspondances entre variables)
- `data = ...` est utile pour lire un `data` modifi√©

---

# Esth√©tiques

Presque toutes les g√©om√©tries supportent les esth√©tiques :

- `x`, `y`, `col` (bord), `fill` (remplissage), `alpha` (transparence).

Autres esth√©tiques :  
- `shape`, `lwd` (poids des lignes), `lty` (type des lignes), `size` (dimension des objets), ...

--

- G√©om√©tries particuli√®res :    
  `xmin`, `xmax`, `ymin`, `ymax`, `group`, ... ‚Üí ![:read_the_docs]
  
--

- On peut les sp√©cifier ailleurs :   
  `geom_*(aes(...))`, ou `ggplot2(aes(...))` (partag√©es parmi les `geoms`)

--

- Variables non in `data` : plac√©s en dehors de `aes`


```r
my_size &lt;- 0.5
ggplot(mtcars, aes(x = mpg, y = wt)) +
* geom_point(aes(col = cyl), size = my_size)
```


---

# Esth√©tiques

Vous pouvez utiliser des expressions :

.small-code[

```r
ggplot(mtcars) +
    geom_point(
      aes(x = qsec, y = mpg, 
*         col = hp/wt,
*         shape = factor(am)),
      size = 5) +
    labs(title = 'Rapport puissance/poids', x = 'Mile time [s]', y = 'Autonomie')
```

![](index_files/figure-html/unnamed-chunk-23-1.svg)&lt;!-- --&gt;
]

---
class: twocol-code-plot

# Un boxplot...

Consommation vs nombre de cylindres

.left-code[


```r
mtcars %&gt;% 
   ggplot(aes(x = factor(cyl), y = mpg)) + 
   geom_boxplot(aes(fill = factor(cyl))) +
   labs(x = 'Cylindres', y = 'Autonomie')
```

`labs(...)` : titres des axes

]
.right-plot[

&lt;img src="index_files/figure-html/boxplot-plot-1.svg" width="95%" style="display: block; margin: auto;" /&gt;
]

--

.left-inline[
Boxplot : m√©diane, quartiles, moustaches
]

--

.left-inline[
... mais qui les a calcul√©s ?
]

---
class: center, middle, inverse

# Les statistiques

---

# Les statistiques

Avant de plotter :

- `data` est s√©par√© en groupes selon les variables discr√®tes :
    + ce qu'on trouve dans `facets`
    + ce qu'on assigne √† `col`, `fill`, `group`, ...

--

- Pour chaque sous-ensemble de `data`, le niveau `stat` calcule tout le n√©cessaire

--

- Cons√©quence : √† chaque `geom` correspond un `stat` (souvent cach√© ! )

--

En pratique :

- `stat` ajoute des **colonnes** √† `data` avec des noms fixes

---

## Les statistiques : exemple

Consommation vs poids : notez les esth√©tiques partag√©es


```r
p &lt;- ggplot(mtcars, aes(x = mpg, y = wt)) + 
     geom_point()
p
```

![](index_files/figure-html/geom-smooth-pre-1.svg)&lt;!-- --&gt;


---

## Les statistiques : exemple

- Ajout du niveau `geom_smooth` : smoothing
  + lin√©aire : `method = "lm"` (et autres)
  + non-lin√©aire : dans ce cas `method = "loess"` (et autres)
--

- `geom_smooth` adore `stat_smooth` :
    + calcule les pr√©dictions `y`, intervalles `ymin`, `ymax`, erreur `se`
    + repr√©sentation graphique optimale


```r
p + geom_smooth(method = 'loess')
```

![](index_files/figure-html/geom-smooth-1.svg)&lt;!-- --&gt;

---
class: slide-class-advanced

## Les statistiques : exemple

- On peut acc√©der aux valeurs avec `stat(...)` dans le m√™me niveau !   
  (vieux code : les nouvelles variables commencent par `...`)

--

- Moyenne + intervalles de confiance pour la moyenne, `\(6\sigma\)`

.small-code[

```r
p + 
  geom_errorbar(aes(ymin = y - 3*stat(se), ymax = y + 3*stat(se), col = stat(se)), 
                alpha = 0.2,
                stat = 'smooth', method = 'loess') +
  scale_color_gradient('Standard error', low = 'blue', high = 'red')
```

![](index_files/figure-html/stat-manual-1.svg)&lt;!-- --&gt;
]



---

# Position



Quand on a des **√©l√©ments superpos√©s** : (p.ex. diagramme √† barre)

- Il y a une `stat_count` cach√©e ! (d√©finit `\(y\)`)
- Par d√©faut, empil√©s (`geom_bar`) ou superpos√©s (`geom_point`) 


```r
ggplot(mtcars) + 
  geom_bar(aes(x = factor(cyl), fill = factor(am)))
```

![](index_files/figure-html/unnamed-chunk-25-1.svg)&lt;!-- --&gt;

---

# Position

Param√®tre `position` :

- `dodge` : √† cot√©


```r
ggplot(mtcars) + 
  geom_bar(aes(x = factor(cyl), fill = factor(am)),
*          position = 'dodge')
```

![](index_files/figure-html/unnamed-chunk-26-1.svg)&lt;!-- --&gt;

---

# Position

Param√®tre `position` :

- `fill` : normalise


```r
ggplot(mtcars) + 
  geom_bar(aes(x = factor(cyl), fill = factor(am)),
*          position = 'fill')
```

![](index_files/figure-html/unnamed-chunk-27-1.svg)&lt;!-- --&gt;

---

# Position

Param√®tre `position` :

- `stack` : empiler


```r
ggplot(mtcars) + 
  geom_bar(aes(x = factor(cyl), fill = factor(am)),
*          position = 'stack')
```

![](index_files/figure-html/unnamed-chunk-28-1.svg)&lt;!-- --&gt;


---

# Position

Param√®tre `position` :

- `jitter` : ajout du bruit pour s√©parer


```r
ggplot(mtcars) + 
  geom_point(aes(x = am, y = vs))
```

![](index_files/figure-html/unnamed-chunk-29-1.svg)&lt;!-- --&gt;

---

# Position

Param√®tre `position` :

- `jitter` : ajout du bruit pour s√©parer


```r
ggplot(mtcars) + 
  geom_point(aes(x = am, y = vs),
*          position = 'jitter')
```

![](index_files/figure-html/unnamed-chunk-30-1.svg)&lt;!-- --&gt;


---
class: small-code

# Position

Param√®tre `position` :

- `jitter` : ajout du bruit pour s√©parer   
  R√©glage ou `geom_jitter()`


```r
ggplot(mtcars) + 
  geom_point(aes(x = am, y = vs),
*            position = position_jitter(width = 0.1, height = 0.1))
```

![](index_files/figure-html/unnamed-chunk-31-1.svg)&lt;!-- --&gt;


  



---

# Coordinates

- Cordonn√©es cart√©siennes x-y   
   `coord_cartesian(xlim = ..., ylim = ..., expand = ...)`

--
   
   + `xlim`, `ylim` : contr√¥le du **zoom**

--
   
   + `expand` (`TRUE`/`FALSE`) : ajout d'espace avant/apr√®s les extr√™mes

--

- Cordonn√©es cart√©siennes aux proportions fix√©s   
   `coord_fixed(ratio = ...)`

--

- Cordonn√©es polaires   
   `coord_polar(theta = 'x', ...)`   
   + `theta` : qui g√®re l'angle   

--

- Cordonn√©es invers√©es   
   `coord_flip()`   
   x devient y


---

# Scales

Correspondance entre les valeurs des **donn√©es** et les valeurs dans le **graphique.**

--

√âchelles aux valeurs ...

- continues : types `numeric`, `int`, `Date`, ...
- discr√®tes : tout le reste (`factor`, `char`, ...)

- Noms : `scale_` + esth√©tique + type d'√©chelle (`continuous`, `discrete`, `manual`, ...) 

--

#### Anatomie d'une √©chelle

Toutes √©chelles acceptent au moins :

- `name` : nom dans la l√©gende

--

- `breaks` : les valeurs seuil o√π on trouve des droites, des signes, ... (d√©faut : intelligent)

--

- `labels` : les cha√Ænes de caract√®res associ√©es aux `breaks` (d√©faut : intelligent)

--

- `trans` : transformation donn√©es ‚Üí (`breaks`, `labels`) (p.ex. `'log10'`)

--

- `limits` : les valeurs aux extr√™mes (`NA` : min/max donn√©es)     
  Aussi : fonctions `xlim( )`, `ylim( )`


---

## Scales : x, y

Exemples : 

- `scale_x_continuous(trans = 'log10')` :  
  √©chelle `\(x\)` logarithmique (`scale_x_log10()`)
- `scale_y_discrete(breaks = c('a', 'b'), labels = c('Premier', 'Deuxi√®me'))` :     
  √©chelle `\(y\)` discr√®te
- `scale_y_datetime()` : √©chelle `\(y\)` pour dates   
  (= `scale_y_continuous(trans = 'date')`)

--

### Scales vs coord\_x\_\* et coord\_y\_\*

&lt;div class="heavy-box center"&gt;&lt;span&gt;&lt;b&gt;scales&lt;/b&gt; : les valeurs au del√† des limites sont &lt;b&gt;remplac√©s&lt;/b&gt; avec &lt;span class="remark-inline-code"&gt;NA&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;

--

&lt;div class="heavy-box center" style='background: red'&gt;&lt;span&gt;‚ö† coupure d'√©l√©ments graphiques ! ‚ö†&lt;/span&gt;&lt;/div&gt;


---
class: slide-class-advanced
exclude: true

&lt;!-- TODO --&gt;

### Scales : expansion des limites

- `expand_limits(x = ..., y = ...)` : √©tendent le graphique jusqu'√† ce(s) point(s) l√†   
  p.ex. `expand_limits(x = 0, y = 0)` pour inclure l'origine
   
- `scale_*_*(expand = expand_scale(mult = ..., add = ...))` :   
  pour d√©cider combien d'espace ajouter autour des bords 

---

## Scales : couleurs, remplissage

Fini avec les couleurs de R !   
--

- √âchelles chromatiques **optimis√©es** et **automatiques**   
--

- Pour les esth√©tiques `col`, `fill`   

--

Continues :

- `scale_color_continuous` : g√©n√©rique
- `scale_color_gradient`, `scale_color_gradient2`, `scale_color_gradientn`
- `scale_color_gray` : valeurs de gris

--

Discr√®tes :

- `scale_color_brewer` : palettes de [ColorBrewer](http://colorbrewer2.org/) : http://colorbrewer2.org/
  + 3 types : **div**erging, **qual**itative, **seq**uential
  + liste : `RColorBrewer::display.brewer.all()`    
&lt;img src="assets/img/brewer.png" class='center' style='width: 60%' /&gt;

---

- `scale_fill_viridis_d` :    
  m√™me principe mais avec la palette Viridis (Python : `matplotlib`)   
  &lt;img src="assets/img/viridis.png" style='width: 65%' /&gt;
 
---
exclude: true

# Scales : exemple

&lt;!-- TODO --&gt;


```r
datasets::swiss %&gt;% 
   rownames_to_column('Location') %&gt;% 
   ggplot(aes(x = Catholic, y = Education)) +
   geom_point()
```

![](index_files/figure-html/unnamed-chunk-32-1.svg)&lt;!-- --&gt;


---
exclude: true

# Scales : exemple

&lt;!-- TODO --&gt;

Donn√©es sur la population US


```r
economics %&gt;% 
   ggplot(aes(x = date)) + 
   geom_line(aes(y = pop)) + 
   expand_limits(y = 0)

storms %&gt;% 
   mutate(time = paste(year, month, day, hour, sep = '-'),
          time = lubridate::parse_date_time(order = 'ymdH')) %&gt;% 
   ggplot() +
   geom_
```



---

# Facets

Deux fa√ßons :

- `facet_wrap(...)` : aligner sur une dimension
- `facet_grid(...)` : aligner en deux dimensions

--

Les axes seront partag√©s entre les graphiques !   
(sauf avec p.ex. `scales = "free_x"`)

--

Param√®tres :

- `...` :   
  + une formule du type `colonnes ~ lignes` (vieille interface)
  + `vars(colonnes), vars(lignes)` (nouvelle interface)

--
class: slide-class-advanced

- `labeller` : types d'√©tiquettes pour les variables dans les onglets   
  `labeller = label_value` : que la valeur   
  `labeller = label_both` : '`nom` : `valeur`'   
  `labeller = label_parsed` : si `valeur` est une expression (`plotmath`)
  

---

# Facets : exemple

Sans onglets :


```r
mtcars %&gt;% 
  ggplot(aes(x = mpg, y = wt, col = factor(cyl))) + 
  geom_point()
```

![](index_files/figure-html/unnamed-chunk-34-1.svg)&lt;!-- --&gt;


---

# Facets : exemple

`facet_wrap` : par transmission (automatique / manuelle)


```r
mtcars %&gt;% 
  ggplot(aes(x = mpg, y = wt, col = factor(cyl))) + 
  geom_point() +
* facet_wrap(~ am) # vars(am)
```

![](index_files/figure-html/unnamed-chunk-35-1.svg)&lt;!-- --&gt;

---

# Facets : exemple

`facet_wrap` avec deux variables (nombre vitesses, transmission)


```r
mtcars %&gt;% 
  ggplot(aes(x = mpg, y = wt, col = factor(cyl))) + 
  geom_point() +
* facet_wrap(gear ~ am) # ou vars(gear, am)
```

![](index_files/figure-html/unnamed-chunk-36-1.svg)&lt;!-- --&gt;


---

# Facets : exemple

`facet_grid` : mieux !


```r
mtcars %&gt;% 
  ggplot(aes(x = mpg, y = wt, col = factor(cyl))) + 
  geom_point() +
* facet_grid(gear ~ am)
```

![](index_files/figure-html/unnamed-chunk-37-1.svg)&lt;!-- --&gt;


---

# Facets : exemple

`facet_grid` : mieux, avec √©tiquettes


```r
mtcars %&gt;% 
  ggplot(aes(x = mpg, y = wt, col = factor(cyl))) + 
  geom_point() +
* facet_grid(gear ~ am, labeller = label_both)
```

![](index_files/figure-html/unnamed-chunk-38-1.svg)&lt;!-- --&gt;



---
class: slide-class-advanced

# Facets : exemple

`facet_grid` : d√©couplage des axes (mais toujours partag√©s ! )


```r
mtcars %&gt;% 
  ggplot(aes(x = mpg, y = wt, col = factor(cyl))) + 
  geom_point() +
* facet_grid(gear ~ am, labeller = label_both, scales = 'free')
```

![](index_files/figure-html/unnamed-chunk-39-1.svg)&lt;!-- --&gt;


---

# Facets : exemple

Rien vous emp√™che d'utiliser des expressions !


```r
mtcars %&gt;% 
  ggplot(aes(x = mpg, y = wt, col = factor(cyl))) + 
  geom_point() +
  facet_grid(paste(gear, 'vitesses') ~ 
             paste('Transmission', 
*                  ifelse(am == 0, 'automatique', 'manuelle')))
```

![](index_files/figure-html/unnamed-chunk-40-1.svg)&lt;!-- --&gt;

--

.protip-popup[
&lt;h4&gt;Protip&lt;/h4&gt;

- mieux transformer les variables *avant* de plotter (`dplyr` : `mutate`)
]

&lt;!--TODO: plotmath --&gt;




---

# Th√®mes

Avec `theme(element = valeur, ...)` vous pouvez modifier les √©l√©ments graphiques   
(‚Üí ![:read_the_docs])

--

.pull-left[.text-small[
  ### `element`

  - `title` : tous les titres
  - `axis.title.*` : les titre des axes
  
  - `axis.text.*` :   
    textes dans les marques sur les axes
  - `axis.ticks.*` :   
    marques sur les axes
  - `axis.line.*` :   
    les droites des axes

  - `legend.*` :   
    les l√©gendes
  - `panel.*` : fond du graphique   
  - `plot.*` : autour le graphique
  - `strip.*` : composants de `facets`
  
  - ... ![:read_the_docs]
]
]

--

.pull-right[

  ### `valeur`

   Tous les √©l√©ments sont du type :

  - `element_line(...)` : droits
  
  - `element_rect(...)` :   
    rectangles (bords, fonds)
  
  - `element_text(...)` : texte
  
  - `element_blank(...)` :   
    pour effacer

]

---

# Th√®mes : un exemple 

Base


```r
p &lt;- ggplot(mtcars, aes(x = mpg, y = wt, col = factor(cyl))) + 
   geom_point() + 
   ggtitle('Autonomie vs poids') + 
   scale_color_discrete('Cylindres') +
   labs(x = 'Autonomie', y = 'Poids') +
   facet_grid(am ~ gear, labeller = label_both)
*p 
```

![](index_files/figure-html/theme-slide-prog-1-1.svg)&lt;!-- --&gt;


---

# Th√®mes : un exemple 

Titre gras


```r
p + theme(
* plot.title = element_text(face = 'bold'))
```

![](index_files/figure-html/theme-slide-prog-2-1.svg)&lt;!-- --&gt;

---

# Th√®mes : un exemple 

Sans le fond


```r
p + theme(
  plot.title = element_text(face = 'bold'),
* panel.background = element_blank())
```

![](index_files/figure-html/theme-slide-prog-3-1.svg)&lt;!-- --&gt;

---

# Th√®mes : un exemple 

Avec axes 


```r
p + theme(
  plot.title = element_text(face = 'bold'),
  panel.background = element_blank(),
* axis.line = element_line(size = 1))
```

![](index_files/figure-html/theme-slide-prog-4-1.svg)&lt;!-- --&gt;

---

# Th√®mes : un exemple 

Fond des onglets


```r
p + theme(
  plot.title = element_text(face = 'bold'),
  panel.background = element_blank(),
  axis.line = element_line(size = 1),
* strip.background = element_rect(fill = 'black'))
```

![](index_files/figure-html/theme-slide-prog-5-1.svg)&lt;!-- --&gt;

---

# Th√®mes : un exemple 

Texte des onglets


```r
p + theme(
  plot.title = element_text(face = 'bold'),
  panel.background = element_blank(),
  axis.line = element_line(size = 1),
  strip.background = element_rect(fill = 'black'),
* strip.text = element_text(color = 'white', face = 'bold'))
```

![](index_files/figure-html/theme-slide-prog-6-1.svg)&lt;!-- --&gt;


---

# Th√®mes : un exemple 

Etiquettes axe x  


```r
p + theme(
  plot.title = element_text(face = 'bold'),
  panel.background = element_blank(),
  axis.line = element_line(size = 1),
  strip.background = element_rect(fill = 'black'),
  strip.text = element_text(color = 'white', face = 'bold'),
* axis.text.x = element_text(angle = 90))
```

![](index_files/figure-html/theme-slide-prog-7-1.svg)&lt;!-- --&gt;

---

# Th√®mes : exemples

Inclus : 

- `theme_bw()` : noir et blanc

![](index_files/figure-html/unnamed-chunk-41-1.svg)&lt;!-- --&gt;

---

# Th√®mes : exemples 

Inclus : 

- `theme_minimal()` : minimaliste

![](index_files/figure-html/unnamed-chunk-42-1.svg)&lt;!-- --&gt;


---

# Th√®mes : exemples 

Inclus : 

- `theme_gray()` : gris

![](index_files/figure-html/unnamed-chunk-43-1.svg)&lt;!-- --&gt;

---

# Th√®mes : exemples 

Package ![:package_cran ggthemes] :

- `theme_fivethirtyeight()`

![](index_files/figure-html/unnamed-chunk-44-1.svg)&lt;!-- --&gt;

---

# Th√®mes : exemples 

Package ![:package_cran ggthemes] :

- `theme_few()`

![](index_files/figure-html/unnamed-chunk-45-1.svg)&lt;!-- --&gt;

---

# Th√®mes : exemples 

Package ![:package_cran ggthemes] :

- `theme_excel()`

![](index_files/figure-html/unnamed-chunk-46-1.svg)&lt;!-- --&gt;

--

&lt;img src="https://media0.giphy.com/media/njl60xjwgrkWY/giphy.gif?cid=3640f6095c981f27764b434a323926c1" class='image-popup-center' style='left: 80%; top: 20%; width: 30%'/&gt;


---
class: twocol-code-plot

#  Th√®mes : composition

.left-code[
### Construction

Les th√®mes sont composables :

```r
my_theme &lt;- theme_bw() + 
   theme(plot.title = element_text(colour = 'red'))

p + my_theme
```

### R√©glage globale

Pour changer toutes les graphiques :


```r
ggplot2::theme_set(my_theme)
```
]

--

.right-plot[

&lt;img src="index_files/figure-html/theme-plus-plot-1.svg" width="95%" style="display: block; margin: auto;" /&gt;

]




---

# Sauvegarde

Facile : fonction `ggsave`   
Dernier plot (ou param√®tre `plot = ...`)


```r
ggsave('myfile.pdf', width = 8, height = 5, units = 'cm')
ggsave('myfile.eps', width = 8, height = 5, units = 'cm')
ggsave('myfile.png', width = 8, height = 5, units = 'cm', dpi = 300)
```

--
class: slide-class-advanced

Cairo PDF (en cas de polices de caract√®res personnalis√©es) :


```r
ggsave('myfile.pdf', device = cairo_pdf)
```

---
class: slide-class-advanced small-code

# Composition d'√©l√©ments

Pour √©viter de r√©p√©ter des √©l√©ments chaque fois :   
- objet `ggplot` + objet `list`


```r
my_opts &lt;- list(
  scale_x_log10(), 
  scale_color_discrete('Cylindres'),
  ggtitle('Mon titre', subtitle = 'Sous-titre')
)
```

--


```r
ggplot(mtcars, aes(x = mpg, y = wt, col = factor(cyl))) + 
         geom_point() +
*        my_opts
```

![](index_files/figure-html/comb-plot-1.svg)&lt;!-- --&gt;


---

# Annotations

Vous pouvez ajouter des annotations o√π vous voulez : 
- couche `annotate(geom = ...)`   
- g√©om√©trie √† choix, unit√©s du graphique
- pas de lien avec des variables !


```r
ggplot(mtcars) + 
    geom_point(aes(x = mpg, y = wt)) +
    annotate('text', x = 29, y = 3, label = 'Du texte', size = 6) +
    annotate("rect", xmin = 21, xmax = 30, ymin = 2, ymax = 4,
      alpha = .2, fill = 'red')
```

![](index_files/figure-html/annotate-plot-1.svg)&lt;!-- --&gt;


---
class: slide-class-advanced

# G√©om√©tries : param√®tre `data`

--

`data` : un `data.frame`, mais aussi une fonction (![:read_the_docs]) :

&gt;    A function will be called with a single argument, the plot data.   
&gt;    The return value must be a `data.frame`, and will be used as the layer data.

--

## Ou : comment √©tiqueter les outliers

Outliers : automobiles trop lourdes

--

Pr√©liminaires : noms des automobiles dans une colonne (![:package_cran tidyr])



.left-code[

```r
mtcars_with_models &lt;- mtcars %&gt;% 
    rownames_to_column('model')

p &lt;- mtcars_with_models %&gt;% 
  ggplot(aes(x = mpg, y = wt)) +
    geom_point(aes(col = factor(cyl)))
```
]

.right-plot[
&lt;img src="index_files/figure-html/unnamed-chunk-50-1.svg" width="95%" style="display: block; margin: auto;" /&gt;
]



---
class: slide-class-advanced small-code
name: slide-data-advanced

## Ou : comment √©tiqueter les outliers

---
template: slide-data-advanced

#### Approche 1 : une √©tiquette vide
&lt;br/&gt;

.left-code-60[

```r
heavy_cars &lt;- quantile(mtcars$wt, 0.9)

mtcars_with_models %&gt;% 
  ggplot(aes(x = mpg, y = wt)) +
    geom_point(aes(col = factor(cyl))) +
    geom_text(aes(label = 
*       ifelse(wt &gt; heavy_cars, model, '')),
      hjust = -0.1, vjust = 0.5)
```
]
.right-plot-30[
&lt;img src="index_files/figure-html/unnamed-chunk-52-1.svg" width="95%" style="display: block; margin: auto;" /&gt;
]

---
template: slide-data-advanced

#### Approche 2 : filtrage du `data`

R√©p√©tition de `data` (sans ne pouvoir rien ajouter avant `ggplot` ! )

.left-code-60[

```r
heavy_cars &lt;- quantile(mtcars$wt, 0.9)

mtcars_with_models %&gt;% 
  ggplot(aes(x = mpg, y = wt)) +
    geom_point(aes(col = factor(cyl))) +
    geom_text(aes(label = model),
      hjust = -0.1, vjust = 0.5,
      data = filter(mtcars_with_models, 
*       wt &gt; heavy_cars)
  )
```
]
.right-plot-30[
&lt;img src="index_files/figure-html/unnamed-chunk-54-1.svg" width="95%" style="display: block; margin: auto;" /&gt;
]

---
template: slide-data-advanced

#### Approche 3 : pipe

Dans une pipe, `.` indique le premier argument (le r√©sultat avant `ggplot`).&lt;sup&gt;1&lt;/sup&gt;

.left-code-60[

```r
heavy_cars &lt;- quantile(mtcars$wt, 0.9)

mtcars_with_models %&gt;% 
  ggplot(aes(x = mpg, y = wt)) +
    geom_point(aes(col = factor(cyl))) +
    geom_text(aes(label = model),
      hjust = -0.1, vjust = 0.5,
*     data = . %&gt;% filter(wt &gt; heavy_cars)
  )
```
]
.right-plot-30[
&lt;img src="index_files/figure-html/unnamed-chunk-56-1.svg" width="95%" style="display: block; margin: auto;" /&gt;
]

.footnote[
[1] Mon approche pr√©f√©r√©e !
]

---
template: slide-data-advanced

#### Approche 4 : une fonction

J'utilise la caract√©ristique du param√®tre ! &lt;sup&gt;1&lt;/sup&gt;

.left-code-60[

```r
heavy_cars &lt;- quantile(mtcars$wt, 0.9)

*my_filter &lt;- function(x) {
* filter(x, wt &gt; heavy_cars)
*} 

mtcars_with_models %&gt;% 
  ggplot(aes(x = mpg, y = wt)) +
    geom_point(aes(col = factor(cyl))) +
    geom_text(aes(label = model),
      hjust = -0.1, vjust = 0.5,
*     data = my_filter
  )
```
]
.right-plot-30[
&lt;img src="index_files/figure-html/unnamed-chunk-58-1.svg" width="95%" style="display: block; margin: auto;" /&gt;
]
.footnote[
[1] Pourquoi est-ce que `my_filter` arrive √† bien trouver `heavy_cars` ? ( difficile ! )   
    La r√©ponse est [ici](https://adv-r.hadley.nz/functions.html)...
]


---
template: slide-data-advanced

#### Approche 5 : une fonction qui retourne une fonction...

Pour conditions multiples&lt;sup&gt;1&lt;/sup&gt; ! **Quasiquotation**&lt;sup&gt;2&lt;/sup&gt;!

.left-code-60[

```r
*filter_df &lt;- function(...) {
* condition &lt;- enquos(...)
* function(df) {
*   df %&gt;% filter(!!!condition)
* }
*} 

mtcars_with_models %&gt;% 
  ggplot(aes(x = mpg, y = wt)) +
    geom_point(aes(col = factor(cyl))) +
    geom_text(aes(label = model),
      hjust = -0.1, vjust = 0.5,
*     data = filter_df(wt &gt; quantile(wt, 0.9))
  )
```
]
.right-plot-30[
&lt;img src="index_files/figure-html/unnamed-chunk-60-1.svg" width="95%" style="display: block; margin: auto;" /&gt;
]

.footnote[
[1] √áa permet d'encha√Æner plusieurs conditions √† la `filter` : p.ex.   
    `filter_df(wt &gt; quantile(wt, 0.9), str_detect(model, 'Audi'))`    
[2] Encore plus difficile ! Explications [ici](https://adv-r.hadley.nz/quasiquotation.html)...   
]



---
class: center, middle, inverse

# Extensions


---

# Ce qui reste

![:package_cran gridExtra] : coller des graphiques diff√©rents dans le m√™me graphique
- in base R : `par(mfrow=...)` 
- [vignette](https://cran.r-project.org/web/packages/gridExtra/vignettes/arrangeGrob.html)

![:package_cran ggRidges] : ridgeline plots
- [vignette](https://cran.r-project.org/web/packages/ggridges/vignettes/gallery.html)

![:package_cran gghighlight] : mise en √©vidence d'√©l√©ments 
- [vignette](https://cran.r-project.org/web/packages/gghighlight/vignettes/gghighlight.html)

![:package_cran ggraph] : **grammaire des graphs** 
- Deux `data.frames` : noeds et liens...


---
class: slide-class-advanced

# plotly

- Package ![:package_cran plotly] : librarie similaire √† `ggplot2`, mais interactive !

--

- traducteur de `ggplot2` √† `plotly` : fonction `ggplotly`

--


```r
library(plotly)

pl &lt;- ggplot(mtcars, aes(x = mpg, y = wt)) + geom_point()

*ggplotly(pl)
```


&lt;iframe src="widgets/plotly_figure.html" width="100%" height="250" scrolling="no" seamless="seamless" frameBorder="0"&gt;&lt;/iframe&gt;


---

# Animations

Package ![:package_cran gganimate]

Vous ajoutez quelques lignes...


```r
library(ggplot2)
library(gganimate)

p &lt;- ggplot(mtcars, aes(factor(cyl), mpg)) + 
  geom_boxplot() + 
* transition_states(
*   gear, transition_length = 2, state_length = 1
* ) +
* enter_fade() +
* exit_shrink() +
* ease_aes('sine-in-out')
```


---

# Animations



![](assets/img/gganimate.gif)


---
class: small-code

# Cartographie

Approche √† la `tidyverse` : package ![:package_cran sf]

--

```r
library(sf)

# Shapefile des cantons
shp &lt;- sf::st_read('data/switzerland_shapefiles/gadm36_CHE_1.shp', quiet = TRUE)

ggplot(shp) +
   geom_sf(aes(fill = (NAME_1 == 'Ticino'))) +
   geom_sf_text(aes(label = NAME_1), size = 3) +
   theme_bw() +
   scale_fill_discrete('', breaks = c(TRUE, FALSE), labels = c('Rigole', 'Travaille'))
```

![](index_files/figure-html/sf-1.svg)&lt;!-- --&gt;



---
class: small-code slide-class-advanced

# Graphs

- Package ![:package_cran tidygraph]
- Package ![:package_cran ggraph]

- grammaire des **graphs**

&lt;!-- TODO --&gt;

---
class: slide-class-advanced

# ggplot2 in Python

Diverses impl√©mentations de la grammaire des graphiques :
- üêç [`plotnine`](https://plotnine.readthedocs.io/)
- üêç [`ggplot`](http://ggplot.yhathq.com/)


```python
from ggplot import *

ggplot(aes(x='date', y='beef'), data=meat) +\
    geom_line() +\
    stat_smooth(colour='blue', span=0.2)
```

.img-small-50[
  ![](assets/img/ggplot_py.png)
]

---
class: center, middle, inverse

# Pour aller plus loin...

---

# Pour aller plus loin...

Galerie des extensions

- [ggplot gallery](https://www.ggplot2-exts.org/gallery/) : https://www.ggplot2-exts.org/gallery/

Conseils :

- suivez des blogs 
  + [RStudio Blog](https://blog.rstudio.com/) 
  + [R-bloggers](https://www.r-bloggers.com/)
  + [Timo Grossenbacher (SRF Data)](https://timogrossenbacher.ch/blog/) (üá©üá™)
  + [SRF Data](https://srfdata.github.io/) (üá©üá™)
- copiez les exemples de GitHub
- exp√©rimentez !

Courses de visualisation des donn√©es 

- [Fundamentals of Data Visualization](https://serialmentor.com/dataviz/) (th√©orie)
- [BBC data journalism cookbook](https://bbc.github.io/rcookbook/) (que `ggplot2`)
- [Edward Tufte](https://www.edwardtufte.com/tufte/) : vieux (et exag√©r√© ? )

---
class: slide-class-advanced

# Ces slides...

## R Markdown

- **Markdown** : langage simple pour r√©diger du texte format√©
- GitHub, blogs...
- **R Markdown** = Markdown avec code int√©gr√©
  pour g√©n√©rer 
  + pages web, blogs, articles, pr√©sentations, interfaces, livres, ... 
- [Galerie](https://rmarkdown.rstudio.com/gallery.html)
- [Guide](https://bookdown.org/yihui/rmarkdown/) (faite avec R Markdown + ![:package_cran blogdown])

### Cette pr√©sentation 

- ![:package_cran xaringan] bas√© sur la librairie [reveal.js](https://revealjs.com)
- M√©lange : R Markdown + CSS (quelques d√©tails)
- [Documentation](http://slides.yihui.name/xaringan/) (c'est une pr√©sentation!)
- [Sources](https://github.com/lgaborini/ggplot2-introduction)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="assets/js/macros.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
